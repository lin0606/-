# CDN介绍

## 什么是CDN

`CDN`的全称是Content Delivery Network，即[内容分发网络](https://baike.baidu.com/item/内容分发网络/4034265)。`CDN`是构建在现有网络基础之上的智能虚拟网络，依靠部署在各地的边缘服务器，通过中心平台的负载均衡、内容分发、调度等功能模块，使用户就近获取所需内容**，**降低网络拥塞**，**提高用户访问响应速度和命中率。`CDN`的关键技术主要有内容存储和分发技术。

## 为什么需要CDN

### 加速访问

CDN可以使用户**就近获取所需内容**，降低网络拥塞，提高用户访问响应速度和命中率。

还提供服务器端加速，解决由于用户访问量大造成的服务器过载问题；

### 实现跨运营商、跨地域的全网覆盖

互联不互通、区域`ISP`地域局限、出口带宽受限制等种种因素都造成了网站的区域性无法访问。

`CDN`加速可以覆盖全球的线路，通过和运营商合作，部署`IDC`资源，在全国骨干节点商，合理部署`CDN`边缘分发存储节点，充分利用带宽资源，平衡源站流量。

### 网站安全

`CDN`的负载均衡和分布式存储技术，可以加强网站的可靠性，相当无无形中给你的网站添加了一把保护伞，应对绝大部分的互联网攻击事件如（`DDos`攻击）。防攻击系统也能避免网站遭到恶意攻击。

### 异地备援

当某个服务器发生意外故障时，系统将会调用其他临近的健康服务器节点进行服务，进而提供接近100%的可靠性，这就让你的网站可以做到永不宕机。

### 节约成本

能克服**网站分布不均**的问题，投入使用CDN加速可以实现网站的全国铺设，你根据不用考虑购买服务器与后续的托管运维，服务器之间镜像同步，也不用为了管理维护技术人员而烦恼，并且能降低网站自身建设和维护成本。

## CDN的组成

### 中心平台

中心节点包括`CDN`网管中心和全局负载均衡`DNS`重定向解析系统，负责整个`CDN`网络的分发及管理。

### 边缘节点

`CDN`边缘节点主要指异地分发节点，由负载均衡设备、高速缓存服务器两部分组成。

**负载均衡设备**负责每个节点中各个Cache的负载均衡，保证节点的工作效率；同时还负责收集节点与周围环境的信息，保持与全局负载均衡`DNS`的通信，实现整个系统的负载均衡。

**高速缓存服务器**（Cache）负责存储客户网站的大量信息，就像一个靠近用户的网站服务器一样响应本地用户的访问请求。通过全局负载均衡`DNS`的控制，用户的请求被透明地指向离他最近的节点，节点中Cache服务器就像网站的原始服务器一样，响应终端用户的请求。因其距离用户更近，故其响应时间才更快。

## `CDN`的工作流程

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fcd8f20339064af1a4e3e4847e0a3d6a~tplv-k3u1fbpfcp-watermark.awebp)

我们首先来看一个传统网站的工作流程：

1. 用户在自己的浏览器中输入要访问的网站域名。

2. 浏览器向本地`DNS`服务器请求对该域名的解析。

3. 本地`DNS`服务器中如果缓存有这个域名的解析结果，则直接响应用户的解析请求。

4. 本地`DNS`服务器中如果没有关于这个域名的解析结果的缓存，则以迭代方式向整个`DNS`系统请求解析，获得应答后将结果反馈给浏览器。

5. 浏览器得到域名解析结果，就是该域名相应的服务设备的`IP`地址 。

6. 浏览器获取`IP`地址之后，经过标准的TCP握手流程，建立TCP连接。

7. 浏览器向服务器发起HTTP请求。

8. 服务器将用户请求内容传送给浏览器。

9. 经过标准的TCP挥手流程，断开TCP连接。

当我们引入`CDN`之后网站访问的流程：

1. 当用户点击网站页面上的内容URL，先经过本地`DNS`系统解析，如果本地`DNS`服务器没有相应域名的缓存，则本地`DNS`系统会将域名的解析权交给[CNAME](https://baike.baidu.com/item/CNAME/9845877?fr=aladdin)指向的**`CDN`专用`DNS`服务器**。

2. `CDN`的`DNS`服务器将`CDN`的**全局负载均衡设备`IP`地址**返回给用户。

3. 用户向`CDN`的全局负载均衡设备发起URL访问请求。

4. `CDN`全局负载均衡设备根据用户`IP`地址，以及用户请求的`URL`，选择一台用户**所属区域的区域负载均衡设备**，并将请求转发到此设备上。

5. 区域负载均衡设备会选择一个**最优的缓存服务器节点**，并从缓存服务器节点处得到**缓存服务器**的`IP`地址，最终将得到的`IP`地址返回给全局负载均衡设备
6. 全局负载均衡设备把服务器的`IP`地址返回给用户。
7. 用户向缓存服务器发起请求，缓存服务器响应用户请求，将用户所需内容传送到用户终端。如果这台缓存服务器上并没有用户想要的内容，而区域均衡设备依然将它分配给了用户，那么这台服务器就要向它的上一级缓存服务器请求内容，直至追溯到网站的源服务器将内容拉到本地。

对于上述第五条，区域负载均衡设备选择最优的缓存服务器阶段的一些判断如下：

1. 根据用户`IP`地址，判断哪一个边缘节点距用户最近；

2. 根据用户所请求的URL中携带的内容名称，判断哪一个边缘节点上有用户所需内容；

3. 查询各个边缘节点当前的负载情况，判断哪一个边缘节点尚有服务能力。



